<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAMCY OS v3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        :root { --nude: #A68A64; --bg: #F8F5F2; --card: #FFFFFF; }
        body { background: var(--bg); font-family: 'Plus Jakarta Sans', sans-serif; color: #4A443F; }
        .page { display: none; padding: 20px 20px 120px; height: 100vh; overflow-y: auto; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        .ios-card { background: var(--card); border-radius: 24px; padding: 18px; box-shadow: 0 4px 15px rgba(0,0,0,0.02); margin-bottom: 15px; border: 1px solid rgba(166,138,100,0.08); }
        .nav-bar { position: fixed; bottom: 25px; left: 20px; right: 20px; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); border-radius: 30px; height: 70px; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.08); z-index: 1000; }
        .nav-btn { color: #CCC; font-size: 22px; transition: 0.3s; }
        .nav-btn.active { color: var(--nude); transform: translateY(-3px); }
        .mood-btn { font-size: 28px; transition: 0.2s; opacity: 0.4; }
        .mood-btn.selected { opacity: 1; transform: scale(1.2); }
        .budget-row { display: grid; grid-template-columns: 1fr 60px 60px; gap: 10px; font-size: 12px; padding: 8px 0; border-bottom: 1px solid #F0EBE6; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="home" class="page active">
        <h1 class="text-2xl font-bold mb-6">Hello Samcy üëã</h1>
        
        <div class="ios-card">
            <p class="text-[10px] font-bold uppercase text-gray-400 mb-4 tracking-widest text-center">Ton Mood Actuel</p>
            <div class="flex justify-around items-center" id="mood-selector">
                <button onclick="updateMood('üòä')" class="mood-btn">üòä</button>
                <button onclick="updateMood('ü§≤')" class="mood-btn">ü§≤</button>
                <button onclick="updateMood('üíç')" class="mood-btn">üíç</button>
                <button onclick="updateMood('üò¥')" class="mood-btn">üò¥</button>
                <button onclick="updateMood('üò§')" class="mood-btn">üò§</button>
            </div>
        </div>

        <div class="ios-card bg-[#A68A64] text-white">
            <p class="text-[10px] uppercase font-bold opacity-80">Total √âconomies</p>
            <h2 class="text-3xl font-bold" id="total-savings">0‚Ç¨</h2>
            <div class="flex mt-4 gap-2">
                <input type="number" id="save-amount" placeholder="Ajouter..." class="bg-white/20 border-none rounded-lg p-2 text-sm w-full placeholder:text-white/50 outline-none">
                <button onclick="addSavings()" class="bg-white text-[#A68A64] px-4 rounded-lg font-bold">+</button>
            </div>
            <div id="savings-history" class="mt-4 text-[10px] space-y-1 opacity-80 overflow-y-auto max-h-20">
                </div>
        </div>

        <div class="ios-card">
            <div class="flex justify-between mb-4">
                <h3 class="font-bold text-sm">Calendrier Projet</h3>
                <span class="text-[10px] text-gray-400" id="current-month">F√©vrier 2026</span>
            </div>
            <div class="grid grid-cols-7 gap-1 text-[10px] text-center font-bold text-gray-400 mb-2">
                <span>L</span><span>M</span><span>M</span><span>J</span><span>V</span><span>S</span><span>D</span>
            </div>
            <div class="grid grid-cols-7 gap-1" id="calendar-grid">
                </div>
        </div>
    </div>

    <div id="islam" class="page">
        <h2 class="text-xl font-bold mb-6">Ma Progression üåô</h2>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="ios-card text-center">
                <p class="text-[10px] font-bold text-gray-400">VERSETS APPRIS</p>
                <div class="text-3xl font-bold my-2" id="v-count">0</div>
                <div class="flex justify-center gap-4">
                    <button onclick="changeIslamCount('versets', -1)" class="w-8 h-8 rounded-full border">-</button>
                    <button onclick="changeIslamCount('versets', 1)" class="w-8 h-8 rounded-full bg-[#A68A64] text-white">+</button>
                </div>
            </div>
            <div class="ios-card text-center">
                <p class="text-[10px] font-bold text-gray-400">PAGES LUES</p>
                <div class="text-3xl font-bold my-2" id="p-count">0</div>
                <div class="flex justify-center gap-4">
                    <button onclick="changeIslamCount('pages', -1)" class="w-8 h-8 rounded-full border">-</button>
                    <button onclick="changeIslamCount('pages', 1)" class="w-8 h-8 rounded-full bg-[#A68A64] text-white">+</button>
                </div>
            </div>
        </div>

        <div class="ios-card">
            <h3 class="font-bold text-sm mb-4">Doua pour nous ü§≤</h3>
            <textarea id="daily-dua" class="w-full bg-[#FDFBF9] rounded-xl p-4 text-sm italic outline-none h-32" placeholder="√âcris ta Doua du jour pour Samcy..."></textarea>
            <button onclick="saveDua()" class="w-full mt-2 py-3 bg-[#A68A64] text-white rounded-xl font-bold text-xs">Enregistrer</button>
        </div>
    </div>

    <div id="budgets" class="page">
        <h2 class="text-xl font-bold mb-6">Nos Budgets üí∏</h2>
        
        <details class="ios-card" open>
            <summary class="font-bold text-sm cursor-pointer outline-none">üíç Budget Mariage</summary>
            <div class="mt-4">
                <div class="budget-row font-bold opacity-50"><span>Prestation</span><span>Pr√©vu</span><span>Pay√©</span></div>
                <div id="wedding-list">
                    </div>
                <button onclick="addBudgetItem('wedding')" class="w-full text-[10px] py-2 mt-2 border-dashed border rounded-lg opacity-50">+ Ajouter ligne</button>
            </div>
        </details>

        <details class="ios-card">
            <summary class="font-bold text-sm cursor-pointer outline-none">üè† Budget Appartement</summary>
            <div class="mt-4">
                <div class="budget-row font-bold opacity-50"><span>Meuble</span><span>Pr√©vu</span><span>Pay√©</span></div>
                <div id="housing-list"></div>
                <button onclick="addBudgetItem('housing')" class="w-full text-[10px] py-2 mt-2 border-dashed border rounded-lg opacity-50">+ Ajouter ligne</button>
            </div>
        </details>
    </div>

    <div id="couple" class="page">
        <h2 class="text-xl font-bold mb-4">Espace Samcy ‚ù§Ô∏è</h2>
        
        <div class="ios-card bg-orange-50/50">
            <p class="text-xs font-bold mb-3">Sondage Photo Flash üì∏</p>
            <div class="grid grid-cols-2 gap-2 mb-3">
                <div class="h-24 bg-gray-200 rounded-xl flex items-center justify-center text-[10px] text-center p-2 border-2 border-white" id="poll-img-1">Photo A</div>
                <div class="h-24 bg-gray-200 rounded-xl flex items-center justify-center text-[10px] text-center p-2 border-2 border-white" id="poll-img-2">Photo B</div>
            </div>
            <div class="flex gap-2">
                <button onclick="vote('A')" class="flex-1 py-2 bg-white rounded-lg text-xs font-bold shadow-sm">Je pr√©f√®re A</button>
                <button onclick="vote('B')" class="flex-1 py-2 bg-white rounded-lg text-xs font-bold shadow-sm">Je pr√©f√®re B</button>
            </div>
        </div>

        <div class="ios-card">
            <h3 class="font-bold text-sm mb-4">Accord / D√©saccord ‚öñÔ∏è</h3>
            <div id="decision-list" class="space-y-3">
                </div>
            <button onclick="addDecision()" class="w-full mt-4 py-2 border rounded-xl text-xs">+ Nouvelle proposition</button>
        </div>
    </div>

    <nav class="nav-bar">
        <button onclick="nav('home', this)" class="nav-btn active"><i class="fa-solid fa-house"></i></button>
        <button onclick="nav('islam', this)" class="nav-btn"><i class="fa-solid fa-moon"></i></button>
        <button onclick="nav('budgets', this)" class="nav-btn"><i class="fa-solid fa-wallet"></i></button>
        <button onclick="nav('couple', this)" class="nav-btn"><i class="fa-solid fa-heart"></i></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, addDoc, updateDoc, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG (Tes cl√©s Firebase)
        const firebaseConfig = {
            apiKey: "AIzaSyCBZ96lSFIWzPsHklwk3ZU8kfWudfp8oVQ",
            authDomain: "samcy-1136c.firebaseapp.com",
            projectId: "samcy-1136c",
            storageBucket: "samcy-1136c.firebasestorage.app",
            messagingSenderId: "337821844780",
            appId: "1:337821844780:web:4a31a07928e36a1f5a5889"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const user = localStorage.getItem('samcy_user') || prompt("Qui es-tu ? (samia/quincy)");
        localStorage.setItem('samcy_user', user);

        // NAVIGATION
        window.nav = (id, btn) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        // 1. MOODS (Changement direct)
        window.updateMood = async (emoji) => {
            await setDoc(doc(db, "moods", user), { emoji });
        };
        onSnapshot(doc(db, "moods", user), (d) => {
            if(d.exists()) {
                document.querySelectorAll('.mood-btn').forEach(b => {
                    b.classList.toggle('selected', b.innerText === d.data().emoji);
                });
            }
        });

        // 2. SAVINGS
        window.addSavings = async () => {
            const amount = parseFloat(document.getElementById('save-amount').value);
            if(!amount) return;
            await addDoc(collection(db, "savings"), { amount, user, date: new Date().toLocaleDateString() });
            document.getElementById('save-amount').value = "";
        };
        onSnapshot(collection(db, "savings"), (snap) => {
            let total = 0;
            let hist = "";
            snap.forEach(d => {
                total += d.data().amount;
                hist += `<div>+ ${d.data().amount}‚Ç¨ par ${d.data().user} (${d.data().date})</div>`;
            });
            document.getElementById('total-savings').innerText = total + "‚Ç¨";
            document.getElementById('savings-history').innerHTML = hist;
        });

        // 3. CALENDRIER (G√©n√©ration du mois actuel)
        const grid = document.getElementById('calendar-grid');
        for(let i=1; i<=28; i++) {
            grid.innerHTML += `<div class="aspect-square bg-gray-50 rounded-lg flex items-center justify-center text-[10px] hover:bg-orange-100">${i}</div>`;
        }

        // 4. ISLAM COUNTER
        window.changeIslamCount = async (type, val) => {
            const ref = doc(db, "islam", user);
            const d = await getDocs(collection(db, "islam")); // simplif√©
            await setDoc(ref, { [type]: (window[type] || 0) + val }, { merge: true });
        };
        onSnapshot(doc(db, "islam", user), d => {
            if(d.exists()){
                window.versets = d.data().versets || 0;
                window.pages = d.data().pages || 0;
                document.getElementById('v-count').innerText = window.versets;
                document.getElementById('p-count').innerText = window.pages;
            }
        });

        // 5. BUDGETS
        window.addBudgetItem = async (cat) => {
            const name = prompt("Nom de la prestation/objet :");
            const prevu = prompt("Budget pr√©vu (‚Ç¨) :");
            if(name) await addDoc(collection(db, "budget_" + cat), { name, prevu, paye: 0 });
        };
        const loadBudget = (cat, id) => {
            onSnapshot(collection(db, "budget_" + cat), snap => {
                let html = "";
                snap.forEach(d => {
                    const data = d.data();
                    html += `<div class="budget-row">
                        <span>${data.name}</span>
                        <span>${data.prevu}‚Ç¨</span>
                        <input type="number" onchange="updatePaye('${cat}','${d.id}', this.value)" class="w-12 bg-gray-50 border-none outline-none text-right" value="${data.paye}">
                    </div>`;
                });
                document.getElementById(id).innerHTML = html;
            });
        };
        window.updatePaye = async (cat, id, val) => {
            await updateDoc(doc(db, "budget_" + cat, id), { paye: val });
        };
        loadBudget('wedding', 'wedding-list');
        loadBudget('housing', 'housing-list');

        // 6. ACCORD / DESACCORD
        window.addDecision = async () => {
            const txt = prompt("Ta proposition (ex: Mur bleu salon) :");
            if(txt) await addDoc(collection(db, "decisions"), { txt, samia: null, quincy: null });
        };
        onSnapshot(collection(db, "decisions"), snap => {
            const el = document.getElementById('decision-list');
            el.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                el.innerHTML += `<div class="p-3 bg-white border rounded-xl flex justify-between items-center text-xs">
                    <span class="font-bold">${data.txt}</span>
                    <div class="flex gap-2">
                        <button onclick="voteDec('${d.id}','ok')" class="px-2 py-1 rounded bg-green-50 text-green-600">D'accord</button>
                        <button onclick="voteDec('${d.id}','no')" class="px-2 py-1 rounded bg-red-50 text-red-600">Pas d'accord</button>
                    </div>
                </div>`;
            });
        });
        window.voteDec = async (id, val) => {
            await updateDoc(doc(db, "decisions", id), { [user]: val });
        };

    </script>
</body>
</html>
