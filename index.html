<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAMCY - Union & Deen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        :root { --primary: #A68A64; --bg: #F9F7F5; --text: #4A443F; }
        body { font-family: 'Outfit', sans-serif; background-color: var(--bg); color: var(--text); height: 100dvh; display: flex; flex-direction: column; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        
        .btn-primary { background: var(--primary); color: white; font-weight: 800; padding: 14px; border-radius: 14px; text-transform: uppercase; width: 100%; letter-spacing: 0.5px; box-shadow: 0 4px 15px rgba(166, 138, 100, 0.2); border: none; }
        .input-style { background: #fff; border: 1px solid #E6DCD3; width: 100%; padding: 14px; border-radius: 14px; outline: none; font-weight: 600; margin-bottom: 8px; font-size: 13px; }
        .card { background: #fff; padding: 16px; border-radius: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.02); margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.8); position: relative; }
        
        .nav-btn { opacity: 0.4; transition: 0.2s; display: flex; flex-direction: column; align-items: center; gap: 2px; color: var(--text); }
        .nav-active { opacity: 1; color: var(--primary); transform: translateY(-2px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Moods */
        .mood-btn { font-size: 30px; opacity: 0.3; transition: 0.3s; filter: grayscale(1); }
        .mood-active { opacity: 1; filter: grayscale(0); transform: scale(1.2); }

        /* Calendar */
        .calendar-day { aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; border-radius: 10px; position: relative; }
        .today { background: var(--primary); color: white; }
        .selected-day { border: 2px solid var(--primary); }
        .has-event::after { content: ''; position: absolute; bottom: 4px; width: 4px; height: 4px; background: var(--primary); border-radius: 50%; }

        .btn-delete { position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px; z-index: 10; border: 2px solid white; cursor: pointer; }
        .vs-img-chat { width: 100%; height: 130px; object-fit: cover; border-radius: 12px; }
    </style>
</head>
<body>

    <section id="auth-view" class="absolute inset-0 z-50 flex flex-col justify-center px-8 bg-[#F9F7F5]">
        <div class="text-center mb-10"><h1 class="text-5xl font-black italic tracking-tighter text-[#A68A64]">SAMCY</h1><p class="text-xs font-bold uppercase text-[#C4A484] mt-2">Notre futur commence ici</p></div>
        <input type="email" id="email" placeholder="Email..." class="input-style">
        <input type="password" id="password" placeholder="Mot de passe..." class="input-style">
        <button id="btn-login" class="btn-primary mt-4">Entrer</button>
    </section>

    <div id="app-view" class="hidden flex-col h-full relative">
        <header class="px-6 py-4 flex justify-between items-center bg-white/80 backdrop-blur-md border-b border-[#E6DCD3]">
            <h2 class="font-black italic text-lg text-[#A68A64]">SAMCY</h2>
            <button id="btn-logout" class="bg-gray-50 text-gray-400 p-2 rounded-full"><i data-lucide="log-out" class="w-4 h-4"></i></button>
        </header>

        <main class="flex-1 overflow-hidden relative">
            
            <section id="tab-home" class="h-full overflow-y-auto p-4 pb-24 no-scrollbar">
                <div class="card text-center">
                    <p class="text-[10px] font-black uppercase text-gray-400 mb-4 tracking-widest">Humeur</p>
                    <div class="flex justify-around mb-4">
                        <button onclick="saveMood('üòä')" class="mood-btn" id="m-üòä">üòä</button>
                        <button onclick="saveMood('üòç')" class="mood-btn" id="m-üòç">üòç</button>
                        <button onclick="saveMood('üò¢')" class="mood-btn" id="m-üò¢">üò¢</button>
                        <button onclick="saveMood('üò¥')" class="mood-btn" id="m-üò¥">üò¥</button>
                        <button onclick="saveMood('üò§')" class="mood-btn" id="m-üò§">üò§</button>
                    </div>
                    <div class="flex justify-around pt-3 border-t border-gray-50">
                        <div><span class="text-[9px] font-bold text-gray-300 block uppercase">Samia</span><span id="mood-samia" class="text-xl">...</span></div>
                        <div><span class="text-[9px] font-bold text-gray-300 block uppercase">Quincy</span><span id="mood-quincy" class="text-xl">...</span></div>
                    </div>
                </div>

                <div class="card bg-[#A68A64] text-white border-none shadow-lg">
                    <p class="text-[10px] font-bold uppercase opacity-80 mb-1">Cagnotte Commune</p>
                    <div class="flex justify-between items-end mb-4">
                        <h3 id="total-savings" class="font-black text-3xl">0 ‚Ç¨</h3>
                        <button onclick="addMoney()" class="bg-white/20 p-2 px-4 rounded-xl text-xs font-bold backdrop-blur-sm shadow-sm">+ / -</button>
                    </div>
                    <div class="border-t border-white/20 pt-3">
                        <p class="text-[9px] font-bold uppercase opacity-60 mb-2">Historique</p>
                        <div id="savings-history" class="space-y-2 max-h-24 overflow-y-auto text-[11px]"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <button onclick="changeMonth(-1)" class="p-1"><i data-lucide="chevron-left" class="w-4 h-4 text-gray-300"></i></button>
                        <h3 id="calendar-title" class="font-black text-xs uppercase tracking-widest text-[#A68A64]">F√©vrier 2026</h3>
                        <button onclick="changeMonth(1)" class="p-1"><i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i></button>
                    </div>
                    <div class="grid grid-cols-7 gap-1 text-[10px] font-bold text-center text-gray-300 mb-2">
                        <span>LUN</span><span>MAR</span><span>MER</span><span>JEU</span><span>VEN</span><span>SAM</span><span>DIM</span>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
                    
                    <div id="day-details" class="hidden mt-4 pt-4 border-t border-gray-50">
                        <div class="flex justify-between items-center mb-2">
                            <span id="selected-date-label" class="text-[10px] font-black uppercase text-[#A68A64]">Date</span>
                            <button onclick="addCalendarEvent()" class="text-[10px] font-bold text-gray-400 underline">Ajouter projet</button>
                        </div>
                        <div id="day-events-list" class="space-y-2 text-xs"></div>
                    </div>
                </div>
            </section>

            <section id="tab-chat" class="hidden h-full flex flex-col pb-24">
                <div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar"></div>
                <div class="p-4 bg-white border-t border-[#E6DCD3] flex gap-2 items-center">
                    <button onclick="openVSModal()" class="bg-indigo-50 text-indigo-500 p-2 px-3 rounded-full font-black text-[10px]">VS</button>
                    <button onclick="askPoll()" class="bg-gray-50 text-gray-400 p-2 rounded-full"><i data-lucide="bar-chart-2" class="w-4 h-4"></i></button>
                    <input type="text" id="chat-input" placeholder="Message..." class="input-style mb-0 rounded-full px-5 border-none bg-gray-50 flex-1">
                    <button onclick="sendChat()" class="bg-[#A68A64] text-white w-10 h-10 rounded-full flex items-center justify-center shadow-md active:scale-90"><i data-lucide="send" class="w-4 h-4"></i></button>
                </div>
            </section>

            <section id="tab-wishlist" class="hidden h-full overflow-y-auto p-4 pb-24 no-scrollbar">
                <div class="card bg-orange-50/50">
                    <h3 class="text-[10px] font-black uppercase text-[#A68A64] mb-3">üéÅ Ajouter un souhait</h3>
                    <input type="text" id="wish-name" placeholder="Nom de l'objet..." class="input-style text-xs">
                    <input type="text" id="wish-link" placeholder="Lien boutique..." class="input-style text-xs">
                    <div class="flex gap-2">
                        <label class="flex-1 bg-white text-gray-400 text-[10px] font-bold py-3 rounded-xl text-center border border-dashed border-[#E6DCD3] cursor-pointer">
                            üì∏ PHOTO GALERIE <input type="file" id="wish-upload" class="hidden" accept="image/*" onchange="handleWishUpload(this)">
                        </label>
                        <button onclick="addWish()" class="flex-1 btn-primary py-3 text-xs">POSTER</button>
                    </div>
                </div>
                <div id="wishlist-grid" class="grid grid-cols-2 gap-3 mt-4"></div>
            </section>

            <section id="tab-deen" class="hidden h-full overflow-y-auto p-4 pb-24 no-scrollbar">
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="card text-center">
                        <p class="text-[10px] font-bold text-gray-400 mb-1 uppercase">Versets</p>
                        <div class="text-2xl font-black text-[#A68A64]" id="cnt-v">0</div>
                        <div class="flex justify-center gap-3 mt-2"><button onclick="updCnt('v',-1)" class="w-7 h-7 rounded-full border text-gray-300">-</button><button onclick="updCnt('v',1)" class="w-7 h-7 rounded-full bg-[#A68A64] text-white">+</button></div>
                    </div>
                    <div class="card text-center">
                        <p class="text-[10px] font-bold text-gray-400 mb-1 uppercase">Pages</p>
                        <div class="text-2xl font-black text-[#A68A64]" id="cnt-p">0</div>
                        <div class="flex justify-center gap-3 mt-2"><button onclick="updCnt('p',-1)" class="w-7 h-7 rounded-full border text-gray-300">-</button><button onclick="updCnt('p',1)" class="w-7 h-7 rounded-full bg-[#A68A64] text-white">+</button></div>
                    </div>
                </div>
                <h3 class="text-xs font-black text-[#A68A64] mb-3 uppercase text-center">Salat du jour ü§≤</h3>
                <div id="prayers-list" class="space-y-2"></div>
            </section>

            <section id="tab-budget" class="hidden h-full overflow-y-auto p-4 pb-24 no-scrollbar">
                <div class="flex gap-2 mb-4">
                    <button onclick="switchBudget('wedding')" id="b-wed" class="flex-1 p-3 rounded-xl font-black text-[10px] uppercase bg-[#A68A64] text-white">üíç Mariage</button>
                    <button onclick="switchBudget('housing')" id="b-house" class="flex-1 p-3 rounded-xl font-black text-[10px] uppercase bg-white text-gray-400">üè† Appart</button>
                </div>
                <div class="card">
                    <input type="text" id="bud-name" placeholder="Poste d√©pense..." class="input-style text-xs">
                    <div class="flex gap-2"><input type="number" id="bud-plan" placeholder="Pr√©vu ‚Ç¨" class="input-style text-xs"><input type="number" id="bud-paid" placeholder="Pay√© ‚Ç¨" class="input-style text-xs"></div>
                    <button onclick="addBudget()" class="btn-primary py-3 text-xs">AJOUTER</button>
                </div>
                <div id="budget-list" class="space-y-2 mt-4"></div>
            </section>
        </main>

        <nav class="absolute bottom-0 w-full bg-white/95 backdrop-blur-md border-t border-[#E6DCD3] flex justify-around py-4 pb-6 z-30">
            <button onclick="switchTab('home')" id="nav-home" class="nav-btn nav-active"><i data-lucide="layout-dashboard" class="w-6 h-6"></i><span class="text-[9px] font-bold">Board</span></button>
            <button onclick="switchTab('chat')" id="nav-chat" class="nav-btn"><i data-lucide="message-circle" class="w-6 h-6"></i><span class="text-[9px] font-bold">Chat</span></button>
            <button onclick="switchTab('wishlist')" id="nav-wishlist" class="nav-btn"><i data-lucide="gift" class="w-6 h-6"></i><span class="text-[9px] font-bold">Wish</span></button>
            <button onclick="switchTab('deen')" id="nav-deen" class="nav-btn"><i data-lucide="kaaba" class="w-6 h-6"></i><span class="text-[9px] font-bold">Deen</span></button>
            <button onclick="switchTab('budget')" id="nav-budget" class="nav-btn"><i data-lucide="wallet" class="w-6 h-6"></i><span class="text-[9px] font-bold">Budget</span></button>
        </nav>
    </div>

    <div id="modal-vs" class="hidden fixed inset-0 z-[100] bg-black/80 flex items-center justify-center p-6 backdrop-blur-md">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 relative">
            <button onclick="closeModal('modal-vs')" class="absolute top-4 right-4 text-slate-400"><i data-lucide="x" class="w-5 h-5"></i></button>
            <h3 class="font-black text-xl text-center text-[#A68A64] mb-6 italic uppercase">Duel Photo üî•</h3>
            <div class="flex gap-3 mb-6">
                <label class="vs-preview cursor-pointer" id="vs-preview-1"><span>A</span><input type="file" class="hidden" accept="image/*" onchange="previewVS(1, this)"></label>
                <label class="vs-preview cursor-pointer" id="vs-preview-2"><span>B</span><input type="file" class="hidden" accept="image/*" onchange="previewVS(2, this)"></label>
            </div>
            <button onclick="sendVS()" class="btn-primary text-xs">ENVOYER LE DUEL</button>
        </div>
    </div>

    <script>
        // --- CONFIG FIREBASE ---
        const firebaseConfig = { 
            apiKey: "AIzaSyCBZ96lSFIWzPsHklwk3ZU8kfWudfp8oVQ", 
            authDomain: "samcy-1136c.firebaseapp.com", 
            projectId: "samcy-1136c", 
            storageBucket: "samcy-1136c.firebasestorage.app", 
            messagingSenderId: "337821844780", 
            appId: "1:337821844780:web:4a31a07928e36a1f5a5889" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let currentUser = null;
        let wishBase64 = null;
        let vsImg1 = null, vsImg2 = null;
        let currentBudgetType = 'wedding';
        
        // CALENDAR VARS
        let currentCalDate = new Date();
        let selectedDate
